<!DOCTYPE HTML>
<html>
<head>

	<title>Gaming Experiment</title>
	<style>
		body {
			margin: 0;
			padding: 0;
			background-color: #000;
		}

		.rendererView {
			position: absolute;
			display: block;
			width: 100%;
			height: 100%;
		}
	</style>
	
	<script src="lib/pixi.dev.js"></script>

</head>
<body>

<script>
window.setTimeout(function() {
    var viewWidth = 800;
    var viewHeight = 600;

    // Create a pixi renderer
    var renderer = PIXI.autoDetectRenderer(viewWidth, viewHeight);
    renderer.view.className = "rendererView";

    // add render view to DOM
    document.body.appendChild(renderer.view);

    // create an new instance of a pixi stage
    var stage = new PIXI.Stage(0xFFFFFF);

    // background image - or is CSS background more performant??
    var bg = PIXI.Sprite.fromImage("background/IMG_1165.JPG");
    bg.width = viewWidth;
    bg.height = viewHeight;
    stage.addChild(bg);
    
    // create a texture from an image path
    var texture = PIXI.Texture.fromImage("gfx/sheep.png");

    var thing = new PIXI.Graphics();
    //thing.position.x = 200;
    //thing.position.y = 200 / 2;
    thing.lineStyle(3, 0x349574, 0.8);
    thing.beginFill(0x8bc5ff, 0.7);
    thing.moveTo(0,0);
    thing.lineTo(300,100);
    thing.lineTo(400,220);
    thing.lineTo(100,320);
    stage.addChild(thing);    
    
    var bunnies = [];
    for (var i = 0; i < 10; i++) {
        createBunny(Math.random() * window.innerWidth, Math.random() * window.innerHeight)
    };

    function createBunny(x, y) {
        // create our little bunny friend..
        var bunny = new PIXI.Sprite(texture);

        // enable the bunny to be interactive.. this will allow it to respond to mouse and touch events
        bunny.interactive = true;

        // center the bunnys anchor point
        bunny.anchor.x = 0.5;
        bunny.anchor.y = 0.5;
        // make it a bit bigger, so its easier to touch
        bunny.scale.x = bunny.scale.y = 1;

        // use the mousedown and touchstart
        bunny.mousedown = bunny.touchstart = function(data)
        {
            // stop the default event...
            data.originalEvent.preventDefault();

            // store a reference to the data
            // The reason for this is because of multitouch
            // we want to track the movement of this particular touch
            this.data = data;
            this.alpha = 0.5;
            this.mask = thing;
            this.dragging = true;
        };

        // set the events for when the mouse is released or a touch is released
        bunny.mouseup = bunny.mouseupoutside = bunny.touchend = bunny.touchendoutside = function(data)
        {
            this.alpha = 1
            this.dragging = false;
            this.mask = null;
            // set the interaction data to null
            this.data = null;
        };

        // set the callbacks for when the mouse or a touch moves
        bunny.mousemove = bunny.touchmove = function(data)
        {
            if(this.dragging)
            {
                var newPosition = this.data.getLocalPosition(this.parent);
                this.position.x = newPosition.x;
                this.position.y = newPosition.y;
            }
        }

        // move the sprite to its designated position
        bunny.position.x = x;
        bunny.position.y = y;
        bunny.rotation = Math.random() * 30;

        // add it to the stage
        stage.addChild(bunny);
        bunnies.push(bunny);
    }

    function animate() {

        for (var i in bunnies) {
            bunnies[i].rotation += 0.01;
        }

        // render the stage
        renderer.render(stage);
        
        requestAnimFrame(animate);
    }

    requestAnimFrame(animate);
}, 200);

	</script>

	</body>
</html>
